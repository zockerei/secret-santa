{% extends 'base.html' %}

{% block content %}
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul>
            {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<h1>Participant Dashboard</h1>

<h2>Current Receiver ({{ current_year }})</h2>
{% if current_receiver %}
    <p>Your current receiver is: <strong>{{ current_receiver.name }}</strong></p>
    
    <!-- New section to display the message from the current receiver -->
    <h3>Message from Your Current Receiver</h3>
    {% if current_receiver_message %}
        <p>{{ current_receiver_message }}</p>
    {% else %}
        <p>Your current receiver hasn't written a message yet.</p>
    {% endif %}
{% else %}
    <p>You do not have a receiver assigned for this year.</p>
{% endif %}

<!-- Past Receivers Section -->
<h2>Past Receivers</h2>
{% if past_receivers %}
    <ul>
        {% for receiver in past_receivers %}
            <li>{{ receiver.receiver_name }} ({{ receiver.year }})</li>
        {% endfor %}
    </ul>
{% else %}
    <p>No past receivers found.</p>
{% endif %}

<h2>Write a Message for Your Future Receiver</h2>
<form action="{{ url_for('add_message') }}" method="POST">
    <textarea name="message_text" rows="5" cols="40" placeholder="Write your message here..." required></textarea><br>
    <button type="submit">Submit Message</button>
</form>

<!-- Display existing messages -->
<h2>Your Message for {{ current_year }}</h2>
{% if pending_messages %}
    <ul>
        {% for message in pending_messages %}
            <li>
                {{ message.message }} (Written for {{ message.year }})
                <a href="{{ url_for('edit_message', message_id=message.id) }}">Edit</a>
                <form action="{{ url_for('delete_message', message_id=message.id) }}" method="POST" style="display:inline;">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this message?');">Delete</button>
                </form>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No pending messages found.</p>
{% endif %}

<!-- Logout Button -->
<form action="{{ url_for('logout') }}" method="POST" style="display:inline;">
    <button type="submit">Logout</button>
</form>

{% endblock %}
