{% extends 'base.html' %}

{% block content %}
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul>
            {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<h1>Participant Dashboard</h1>

<h2>Current Receiver ({{ current_year }})</h2>
{% if current_receiver %}
    <p>Your current receiver is: <strong>{{ current_receiver.name }}</strong></p>
{% else %}
    <p>You do not have a receiver assigned for this year.</p>
{% endif %}

<!-- Past Receivers Section -->
<h2>Past Receivers</h2>
{% if past_receivers %}
    <ul>
        {% for receiver in past_receivers %}
            <li>{{ receiver.name }} ({{ receiver.year }})</li>
        {% endfor %}
    </ul>
{% else %}
    <p>No past receivers found.</p>
{% endif %}

<h2>Write a Message for Your Future Receiver</h2>
<form action="{{ url_for('add_message') }}" method="POST">
    <textarea name="message_text" rows="5" cols="40" placeholder="Write your message here..." required></textarea><br>
    <button type="submit">Submit Message</button>
</form>

<!-- Display existing messages -->
<h2>Your Pending Messages</h2>
{% if pending_messages %}
    <ul>
        {% for message in pending_messages %}
            <li>{{ message.message_text }} (Written on {{ message.created_at }})</li>
        {% endfor %}
    </ul>
{% else %}
    <p>No pending messages found.</p>
{% endif %}

<!-- Logout Button -->
<form action="{{ url_for('logout') }}" method="POST" style="display:inline;">
    <button type="submit">Logout</button>
</form>

{% endblock %}
