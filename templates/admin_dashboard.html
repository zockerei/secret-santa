<style>
  .participants-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .participant-block {
    border: 1px solid #ccc;
    padding: 10px;
    width: 300px;
    box-sizing: border-box;
  }
  .receiver-list {
    list-style: none;
    padding-left: 0;
  }
  .receiver-list li {
    margin-bottom: 5px;
  }
  .add-receiver-form {
    margin-top: 10px;
  }
</style>

{% extends 'base.html' %}

{% block content %}
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul>
            {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<h1>Admin Dashboard</h1>

<!-- Logout Button -->
<form action="{{ url_for('logout') }}" method="POST" style="display:inline;">
    <button type="submit">Logout</button>
</form>

<!-- Add Participant Section -->
<h2>Add Participant</h2>
<form action="{{ url_for('add_new_participant') }}" method="POST">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" placeholder="Enter name" required oninput="this.value = this.value.toLowerCase()"><br><br>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" placeholder="Enter password" required><br><br>

    <button type="submit">Add Participant</button>
</form>

<!-- Manage Participants Section -->
<h2>Manage Participants</h2>
<ul>
    {% for participant in participants %}
        <li>
            {{ participant.name }}
            <a href="{{ url_for('edit_participant', participant_id=participant.id) }}">Edit</a> |
            <form action="{{ url_for('remove_participant', person_id=participant.id) }}" method="POST" style="display:inline;">
                <button type="submit">Remove</button>
            </form>
        </li>
    {% endfor %}
</ul>

<!-- New Secret Santa Assignments Section -->
<h2>New Secret Santa Assignments</h2>
{% if assignments %}
    <ul>
        {% for giver, recipient in assignments.items() %}
            <li>{{ giver }} â†’ {{ recipient }}</li>
        {% endfor %}
    </ul>
{% else %}
    <p>No new assignments yet.</p>
{% endif %}

<!-- Scoreboard Section -->
<h2>Scoreboard: Past Participants and Receivers</h2>
<div class="participants-container">
    {% for participant in participants %}
        <div class="participant-block">
            <strong>{{ participant.name }}</strong>
            <ul class="receiver-list">
                {% for receiver in scoreboard[participant.name] %}
                    <li>
                        {{ receiver.receiver_name }} ({{ receiver.year }})
                        <form action="{{ url_for('remove_receiver', person_id=participant.id, receiver_name=receiver.receiver_name, year=receiver.year) }}" method="POST" style="display:inline;">
                            <button type="submit">Remove</button>
                        </form>
                    </li>
                {% else %}
                    <li>No receivers assigned yet.</li>
                {% endfor %}
            </ul>

            <!-- Add Receiver Form -->
            <form class="add-receiver-form" action="{{ url_for('add_receiver', person_id=participant.id) }}" method="POST">
                <label for="receiver_name_{{ participant.id }}">Add Past Receiver:</label>
                <input type="text" id="receiver_name_{{ participant.id }}" name="receiver_name" placeholder="Enter receiver name" required oninput="this.value = this.value.toLowerCase()">

                <label for="year_{{ participant.id }}">Year:</label>
                <input type="number" id="year_{{ participant.id }}" name="year" placeholder="Enter year" required>

                <button type="submit">Add Receiver</button>
            </form>
        </div>
    {% endfor %}
</div>

<!-- Start a New Run Section -->
<h2>Start a New Run</h2>
<form action="{{ url_for('start_new_run') }}" method="POST">
    <label for="year">Year:</label>
    <input type="number" id="year" name="year" placeholder="Enter year" required>
    <button type="submit">Generate New Assignments</button>
</form>

{% endblock %}
