<style>
  .participants-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .participant-block {
    border: 1px solid #ccc;
    padding: 10px;
    width: 300px;
    box-sizing: border-box;
  }
  .receiver-list {
    list-style: none;
    padding-left: 0;
  }
  .receiver-list li {
    margin-bottom: 5px;
  }
  .add-receiver-form {
    margin-top: 10px;
  }
</style>

{% extends 'base.html' %}

{% block content %}
    {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul>
      {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<h1>Admin Dashboard</h1>

<!-- Logout Button -->
<form action="{{ url_for('logout') }}" method="POST" style="display:inline;">
    <button type="submit">Logout</button>
</form>

<h2>Add Participant</h2>
<form action="{{ url_for('add_participant') }}" method="POST">
    <input type="text" name="name" placeholder="Enter name" required oninput="this.value = this.value.toLowerCase()">
    <input type="password" name="password" placeholder="Enter password" required>
    <button type="submit">Add Participant</button>
</form>

<h2>Manage Participants</h2>
<ul>
    {% for participant in participants %}
        <li>{{ participant[1] }} (Role: {{ participant[2] }})
            <a href="{{ url_for('edit_participant', id=participant[0]) }}">Edit</a> |
            <form action="{{ url_for('remove_participant', person_id=participant[0]) }}" method="POST" style="display:inline;">
                <button type="submit">Remove</button>
            </form>
        </li>
    {% endfor %}
</ul>

<h2>New Secret Santa Assignments</h2>
{% if assignments %}
    <ul>
    {% for giver, recipient in assignments.items() %}
        <li>{{ giver }} â†’ {{ recipient }}</li>
    {% endfor %}
    </ul>
{% endif %}

<h2>Scoreboard: Past Participants and Receivers</h2>
<div class="participants-container">
    {% for participant_name, receivers in scoreboard.items() %}
        <div class="participant-block">
            <strong>{{ participant_name }}</strong>
            <ul class="receiver-list">
                {% for receiver, year in receivers %}
                    <li>
                        {{ receiver }} ({{ year }})
                        <form action="{{ url_for('remove_receiver', person_id=participants_ids[participant_name], receiver_name=receiver, year=year) }}" method="POST" style="display: inline;">
                            <button type="submit">Remove</button>
                        </form>
                    </li>
                {% else %}
                    <li>No receivers assigned yet.</li>
                {% endfor %}
            </ul>

            <form class="add-receiver-form" action="{{ url_for('add_receiver', person_id=participants_ids[participant_name]) }}" method="POST">
                <input type="text" name="receiver_name" placeholder="Add past receiver" required oninput="this.value = this.value.toLowerCase()">
                <input type="number" name="year" placeholder="Enter year" required>
                <button type="submit">Add Receiver</button>
            </form>
        </div>
    {% endfor %}
</div>

<h2>Start a New Run</h2>
<form action="{{ url_for('start_new_run') }}" method="POST">
    <input type="number" name="year" placeholder="Enter year" required>
    <button type="submit">Generate New Assignments</button>
</form>

{% endblock %}
